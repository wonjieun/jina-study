# 03 다중 서버 환경 구성

한 대의 서버 인스턴스가 아닌 여러 대의 서버 인스턴스로 서비스를 하면 많은 트래픽에 대응할 수 있고 서버에 장애가 생겨도 서비스가 안전하게 돌아갈 수 있게 한다.

늘어난 트래픽을 감당하기 위해 서버의 수를 늘리는 scale out 다중 서버 환경을 구성해본다. 트래픽에 따라 서버의 수를 자동으로 늘이고 줄이는 auto scaling에 대해서도 배운다.

**서버의 처리 능력을 향상 시키는 방법**
`Scale out` 서버의 대수를 늘리는 것. 분산 처리

예) 웹사이트의 접속자가 증가해서 트래픽이 많이 발생, 웹서버

`Scale up` 서버의 처리 능력을 고성능 모델로 증강 시키는 것

예) 데이터베이스의 빈번한 갱신이 필요한 경우, 데이터베이스 서버

## 3.1 AWS Auto Scaling 그룹을 이용한 다중 서버 구성

### 3.1.1 AWS Auto Scaling 그룹

- AWS에서 제공하는 자동 다중 서버 서비스
- 같은 사양/환경/코드를 가지고 있는 똑같은 EC2 인스턴스들이 묶음
- 자동으로 인스턴스들의 수를 auto scaling
- 장점:
    - 실시간 트래픽 등의 변수를 반영하여 auto scaling 하기 때문에 안정적으로 서비스를 운영
    - 비용을 절감
    - 인스턴스 수의 변화와 이력 조회 가능

### 3.1.2 AWS Auto Scaling 그룹의 응용 예

**자원 사용량을 기준으로 한 자동 조정**

**시간을 기준으로 한 자동 조정**

### 3.1.3 AWS Auto Scaling 그룹의 구성

1. Auto Scaling 그룹을 생성하기 위해 자동으로 생성할 EC2 Instance를 고른다.
2. 현재 환경(OS, 디스크 내용 등)을 snapshot으로 생성하여 AMI(Amazon Machine Image)를 만든다.
3. 이 AMI를 이용해 어떤 설정의 인스턴스를 띄울지 미리 정의해두는 시작 템플릿(Launch Templates)을 생성한다.
4. 시작 템플릿을 이용해 인스턴스를 실행할 Auto Scaling 그룹을 생성한다.

### 3.1.4 [실습] Auto Scaling 그룹 생성

### 3.1.5 Auto Scaling 그룹 화면 구성

### 3.1.6 [실습] Auto Scaling을 통한 인스턴스 자동 추가, 제거

## 3.2 AWS Elastic Load Balancing을 이용한 서버 트래픽 분산 관리

### 3.2.1 Elastic Load Balancing (로드 밸런서)

- 로드 밸런서는 클라이언트의 요청을 직접 받고 로드 밸런서가 관리하는 서버들에게 요청을 골고루 전달해주는 역할을 한다.
- 요청한 포트에 따라 다양한 대상 그룹으로 그 요청을 전달할 수 있다.

### 3.2.2 Target Group (대상 그룹)

- 대상 그룹은 로드 밸랜서가 요청을 전달할 서버들을 묶어둔 개념적인 그룹이다.
- 로드 밸런서가 요청을 보낼 인스턴스들을 더 쉽게 관리하기 위해 만든 기능이다.
- 대상 그룹 내에는 인스턴스나 Auto Scaling 그룹이 포함될 수 있다.
- 로드 밸런서에 인스턴스나 Auto Scaling 그룹을 직접 등록하지 않고, 대상 그룹이라는 개념을 중간에 두는 이유는 하나의 로드 밸런서에 여러 대상 그룹들을 연결할 수 있기 때문이다.

### 3.2.3 로드 밸런서의 상태 검사

- 로드 밸런서는 관리하는 서버 중 정상적으로 동작하고 있는 서버에만 요청을 전달해준다.
- 정상적으로 동작하고 있는지 확인하기 위해 주기적인 상태 검사(Health Check) 과정을 거치게 된다.

### 3.2.4 [실습] Auto Scaling 그룹, 대상 그룹, 로드 밸런서 구성

- 로드 밸런서의 DNS 주소가 자동으로 발급되어, 브라우저에 접속을 시도할 수 있다.
    - 이 주소를 nginx에 server_name으로 등록해두지 않았지만, nginx에서 요청을 받았을 때 정확히 일치하는 서버가 없더라도 요청에 가장 근접한 서버를 찾아서 실행해준다.

## 3.3 장애 조치 아키텍처 구성

### 3.3.1 Auto Scaling 그룹을 이용한 장애 조치

### 3.3.2 [실습] Auto Scaling 그룹과 로드 밸런서를 통한 장애 조치

## 3.4 정리

- 로드 밸런서라는 레이어를 서버 앞에 둠으로써 단일 서버 환경에서는 할 수 없었던 스케일 아웃을 할 수 있게 되었다.
- Auto Scaling 그룹이라는 AWS 서비스를 이용해 실시간 요청량에 따라 유연하게 서버 수를 관리할 수 있게 되었다.
- 자동 조정 개념은 비용 절감과 안정적인 서버 운영이라는 장점이 있다.